!function(a){"use strict";window.namespace=function(b,c){for(var d,e=window,f=b.split(".");d=f.shift();)e[d]=e[d]||{},e=e[d];a.extend(e,c)}}(window._),function(){namespace("Weather"),Weather.API=function(){function a(){}return a.getCurrentConditions=function(a,b){var c;return c=this.generateUrl(a),$.get(c,function(a){return b.showCurrentWeather(a.current_observation),a},"jsonp")},a.generateUrl=function(a){return"http://api.wunderground.com/api/"+a.key+"/conditions/q/"+a.zipcode+".json"},a}()}.call(this),function(){namespace("Weather"),Weather.Controller=function(){function a(){}return a.setupWidgetIn=function(a){return new Weather.Widgets.Controller(a).initialize()},a}()}.call(this),function(){namespace("Weather"),Weather.Display=function(){function a(){}return a.generateLogo=function(a){return'<i class="fa fa-umbrella '+a["class"]+'" data-id="'+a.dataId+'"></i>'},a}()}.call(this),function(){namespace("Weather"),Weather.Templates=function(){function a(){}return a.renderLogo=function(a){return _.template("<img src='<%= imgData['imgSrc'] %>' data-id='<%= imgData['dataId'] %>' style='width: <%= imgData['width'] %>px'/>",{imgData:a})},a}()}.call(this),function(){namespace("Weather.Widgets"),Weather.Widgets.API=function(){function a(){}return a.getCurrentConditions=function(a,b){var c;return c=this.generateUrl(a),$.get(c,function(a){return b.showCurrentWeather(a.current_observation),a},"jsonp")},a.generateUrl=function(a){return"http://api.wunderground.com/api/"+a.key+"/conditions/q/"+a.location+".json"},a}()}.call(this),function(){namespace("Weather.Widgets"),Weather.Widgets.Controller=function(){function a(a){b=a.key,this.container=a.container,this.display=new Weather.Widgets.Display(this.container,a.animationSpeed),this.refresh=a.refresh,this.activeStatus=!1,this.defaultValue=a.defaultValue}var b;return b=void 0,a.prototype.initialize=function(){return this.display.setupWidget(),this.bind(),this.displayDefault(),this.setAsActive()},a.prototype.displayDefault=function(){return this.defaultValue?this.displayCurrentConditions(this.defaultValue):void 0},a.prototype.setAsActive=function(){return this.activeStatus=!0},a.prototype.setAsInactive=function(){return this.activeStatus=!1},a.prototype.isActive=function(){return this.activeStatus},a.prototype.bind=function(){return $(""+this.container+" [data-name=widget-form]").submit(function(a){return function(b){return b.preventDefault(),a.processClickedButton()}}(this)),$(""+this.container+" [data-name=widget-close]").click(function(a){return function(){return a.closeWidget()}}(this))},a.prototype.processClickedButton=function(){return this.input=this.display.getInput(),this.displayCurrentConditions(this.input)},a.prototype.displayCurrentConditions=function(a){var c;return c={key:b,location:a},Weather.Widgets.API.getCurrentConditions(c,this.display),this.refresh?this.initializeRefresh(a):void 0},a.prototype.initializeRefresh=function(a){return this.clearActiveTimeout(),this.processRefresh(a)},a.prototype.clearActiveTimeout=function(){return this.timeout?clearTimeout(this.timeout):void 0},a.prototype.processRefresh=function(a){return this.timeout=setTimeout(function(b){return function(){return b.isActive()?b.refreshCurrentConditions(a):void 0}}(this),this.nextRefresh())},a.prototype.refreshCurrentConditions=function(a){var b;return b=this.display.getDisplayedTime(),this.isTimeToRefresh(b)?this.displayCurrentConditions(a):(this.initializeRefresh(a),this.display.incrementTime())},a.prototype.isTimeToRefresh=function(a){var b;return b=this.display.getLastChar(a),9===parseInt(b)},a.prototype.nextRefresh=function(){var a;return a=new Date,1e3*(60-a.getSeconds())},a.prototype.closeWidget=function(){return this.unbind(),this.removeContent(),this.setAsInactive()},a.prototype.removeContent=function(){return this.display.removeWidget()},a.prototype.unbind=function(){return $(""+this.container+" [data-name=widget-form]").unbind("submit"),$(""+this.container+" [data-name=widget-close]").unbind("click")},a}()}.call(this),function(){namespace("Weather.Widget"),Weather.Widgets.Display=function(){function a(a,b){this.container=a,this.animationSpeed=b}return a.prototype.setupWidget=function(){var a;return a=Weather.Widgets.Templates.renderForm(),$(this.container).append(a)},a.prototype.getInput=function(){return $(""+this.container+" [name=widget-input]").val()},a.prototype.showCurrentWeather=function(a){var b,c;return b=Weather.Widgets.ResponseFormater.process(a),c=Weather.Widgets.Templates.renderCurrentConditions(b),$(""+this.container+" [data-name=widget-output]").html(c)},a.prototype.removeWidget=function(){return $(this.container).remove()},a.prototype.getDisplayedTime=function(){return $(""+this.container+" [data-id=weather-time]").text()},a.prototype.incrementTime=function(){var a,b,c,d;return a=this.getDisplayedTime(),d=this.getLastChar(a),b=parseInt(d)+1,c=a.replace(/\d$/,b),this.setTime(c)},a.prototype.getLastChar=function(a){return a[a.length-1]},a.prototype.setTime=function(a){return $(""+this.container+" [data-id=weather-time]").text(a)},a}()}.call(this),function(){namespace("Weather.Widgets"),Weather.Widgets.ResponseFormater=function(){function a(){}return a.process=function(a){var b,c;return c=Weather.Widgets.TimeFormater.process(a.local_time_rfc822),b={},b.location=a.display_location.full,b.weatherDescription=a.weather,b.temperature=""+a.temp_f+"&deg;",b.iconUrl=a.icon_url,b.localTime=c.time,b.amOrPm=c.amOrPm,b},a}()}.call(this),function(){namespace("Weather.Widgets"),Weather.Widgets.Templates=function(){function a(){}return a.renderForm=function(){return _.template("<div class='widget' data-name='widget-wrapper'>\n  <div class='widget-header' data-name='sortable-handle'>\n    <h2 class=\"widget-title\">Weather</h2>\n    <span class='widget-close' data-name='widget-close'>Ã—</span>\n    <form class='widget-form' data-name='widget-form'>\n      <input name='widget-input' type='text' autofocus='true'>\n      <button data-name=\"form-button\">Get current weather</button><br>\n    </form>\n  </div>\n  <div class=\"widget-body\" data-name=\"widget-output\"></div>\n</div>",{})},a.renderCurrentConditions=function(a){return _.template('<div class="weather-location-container">\n  <p class="weather-location"><%= location %> </p>\n  <p class="weather-local-time">\n    <span class="weather-time" data-id="weather-time"><%= localTime %></span>\n    <span class="weather-am-pm"><%= amOrPm %></span>\n  </p>\n</div>\n<div class="weather-information-container">\n  <img class="weather-description-icon" src=\'<%= iconUrl %>\'>\n  <p class="weather-temperature"><%= temperature %></p>\n</div>',a)},a}()}.call(this),function(){namespace("Weather.Widgets"),Weather.Widgets.TimeFormater=function(){function a(){}return a.process=function(a){var b,c,d,e;return c=this.getDateObjWithNoTimezone(a),d=this.getHours(c),e=this.getMinutes(c),b=this.getAmPm(c),{time:""+d+":"+e,amOrPm:b}},a.getDateObjWithNoTimezone=function(a){var b;return b=a.substring(0,a.length-6),new Date(b)},a.getMinutes=function(a){var b;return b=a.getMinutes(),10>b?"0"+b:b},a.getHours=function(a){var b;return b=a.getHours(),b>12?b-12:b},a.getAmPm=function(a){var b;return b=a.getHours(),this.isBeforeNoon(b)?"AM":"PM"},a.isBeforeNoon=function(a){return 12>a},a}()}.call(this);